<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AP CSP Web Client</title>
    <script src="jquery.min.js"></script>
  </head>
  <body class="noselect">
    <h1 class="infotext"></h1>

    <div class="keys noselect">
      <div class="up arr noselect"><i class="fa fa-arrow-up noselect"></i></div>
      <br />
      <div class="left arr noselect">
        <i class="fa fa-arrow-left noselect"></i>
      </div>
      <div class="down arr noselect">
        <i class="fa fa-arrow-down noselect"></i>
      </div>
      <div class="right arr noselect">
        <i class="fa fa-arrow-right noselect"></i>
      </div>
    </div>

    <div class="keys-2 noselect">
      <div class="horn arr noselect">
        <i class="fa fa-arrow-up noselect"></i>
      </div>
      <br />
      <div class="right-turn arr noselect">
        <i class="fa fa-arrow-right noselect"></i>
      </div>
      <div class="left-turn arr noselect">
        <i class="fa fa-arrow-right noselect"></i>
      </div>
    </div>
    <br />
    <br />
    <br />
    <br />
    <div class="names noselect">
      <div class="uptext noselect"></div>
      <div class="downtext noselect"></div>
      <div class="lefttext noselect"></div>
      <div class="righttext noselect"></div>
      <div class="b noselect"></div>
      <div class="a noselect"></div>
    </div>
  </body>

  <script>
    setInterval(async () => {
      let data = await (await fetch("/data")).json();
      $("h1").text(
        `front: ${data.front} | back: ${data.back} | sound ${data.sound}`
      );
    }, 500);

    var url = window.location.host.split(":")[0];
    const ws = new WebSocket(`ws://${url}:6969`);
    function send(data) {
      if (ws.readyState === 1) {
        ws.send(data);
      }
    }

    $(document).keydown(function (e) {
      if (e.which == 37) {
        $(".left").addClass("pressed");
        $(".lefttext").text("LEFT");
        $(".left").css("transform", "translate(0, 2px)");
        // fetch("/direction?direction=left");
        send("2");
      } else if (e.which == 38) {
        $(".up").addClass("pressed");
        $(".uptext").text("UP");
        $(".left").css("transform", "translate(0, 2px)");
        $(".down").css("transform", "translate(0, 2px)");
        $(".right").css("transform", "translate(0, 2px)");
        // fetch("/direction?direction=forward");
        send("0");
      } else if (e.which == 39) {
        $(".right").addClass("pressed");
        $(".righttext").text("RIGHT");
        $(".right").css("transform", "translate(0, 2px)");
        // fetch("/direction?direction=right");
        send("3");
      } else if (e.which == 40) {
        $(".down").addClass("pressed");
        $(".downtext").text("DOWN");
        $(".down").css("transform", "translate(0, 2px)");
        // fetch("/direction?direction=backward");
        send("1");
      }
    });

    $(document).keyup(function (e) {
      if (e.which == 37) {
        $(".left").removeClass("pressed");
        $(".lefttext").text("");
        $(".left").css("transform", "translate(0, 0)");
        // fetch("/direction?direction=stop");
        send("2");
      } else if (e.which == 38) {
        $(".up").removeClass("pressed");
        $(".uptext").text("");
        $(".left").css("transform", "translate(0, 0)");
        $(".down").css("transform", "translate(0, 0)");
        $(".right").css("transform", "translate(0, 0)");
        // fetch("/direction?direction=stop");
        send("0");
      } else if (e.which == 39) {
        $(".right").removeClass("pressed");
        $(".righttext").text("");
        $(".right").css("transform", "translate(0, 0)");
        // fetch("/direction?direction=stop");
        send("3");
      } else if (e.which == 40) {
        $(".down").removeClass("pressed");
        $(".downtext").text("");
        $(".down").css("transform", "translate(0, 0)");
        // fetch("/direction?direction=stop");
        send("1");
      }
    });

    $(".left").mousedown(function () {
      $(".lefttext").text("LEFT");
      $(".left").css("transform", "translate(0, 2px)");
      // fetch("/direction?direction=left");
      send("2");
    });

    $(".left").mouseup(function () {
      $(".lefttext").text("");
      $(".left").css("transform", "translate(0, 0)");
      // fetch("/direction?direction=stop");
      send("2");
    });

    $(".right").mousedown(function () {
      $(".righttext").text("RIGHT");
      $(".right").css("transform", "translate(0, 2px)");
      // fetch("/direction?direction=right");
      send("3");
    });

    $(".right").mouseup(function () {
      $(".righttext").text("");
      $(".right").css("transform", "translate(0, 0)");
      // fetch("/direction?direction=stop");
      send("3");
    });

    $(".up").mousedown(function () {
      $(".uptext").text("UP");
      $(".left").css("transform", "translate(0, 2px)");
      $(".down").css("transform", "translate(0, 2px)");
      $(".right").css("transform", "translate(0, 2px)");
      // fetch("/direction?direction=forward");
      send("0");
    });

    $(".up").mouseup(function () {
      $(".uptext").text("");
      $(".left").css("transform", "translate(0, 0)");
      $(".down").css("transform", "translate(0, 0)");
      $(".right").css("transform", "translate(0, 0)");
      // fetch("/direction?direction=stop");
      send("0");
    });

    $(".down").mousedown(function () {
      $(".downtext").text("DOWN");
      $(".down").css("transform", "translate(0, 2px)");
      // fetch("/direction?direction=backward");
      send("1");
    });

    $(".down").mouseup(function () {
      $(".downtext").text("");
      $(".down").css("transform", "translate(0, 0)");
      // fetch("/direction?direction=stop");
      send("1");
    });

    leftinterval = "";
    rightinterval = "";

    $(".left-turn").mousedown(() => {
      if (leftinterval != "") {
        clearInterval(leftinterval);
        leftinterval = "";
      } else {
        leftinterval = setInterval(() => {
          send("7");
          send("9");
        }, 500);
      }
    });
    $(".right-turn").mousedown(() => {
      if (rightinterval != "") {
        clearInterval(rightinterval);
        rightinterval = "";
      } else {
        rightinterval = setInterval(() => {
          send("6");
          send("8");
        }, 500);
      }
    });

    $(".horn").mousedown(() => {
      send("5");
    });
    $(".horn").mouseup(() => {
      send("5");
    });
  </script>
</html>

<style>
  html {
    background: radial-gradient(#000, #111);
    height: 100%;
    margin: 0;
    height: 100%;
    overflow: hidden;
  }

  .infotext {
    position: absolute;
    font-family: "Lato", sans-serif;
    text-align: center;
    color: white;
    top: 10px;
    width: 100%;
  }

  .keys {
    font-family: "Lato", sans-serif;
    text-align: center;
    width: 350px;
    height: 200px;
    margin: auto;
    margin-top: 200px;
  }

  .keys-2 {
    font-family: "Lato", sans-serif;
    text-align: center;
    width: 350px;
    height: 200px;
    margin: auto;
    margin-top: 150px;
  }

  .arr {
    cursor: pointer;
    width: 100px;
    height: 100px;
    text-align: center;
    line-height: 100px;
    background: grey;
    color: white;
    font-size: 50px;
    border-right: 10px solid darken(grey, 20);
    border-bottom: 10px solid darken(grey, 20);
    border-left: 10px solid darken(grey, 15);
    border-top: 10px solid darken(grey, 10);
    display: inline-block;
    margin: 5px;
    transition: all 0.05s linear;
    &:active {
      border-bottom: 8px solid darken(grey, 20);
      text-shadow: 0 0 10px white, 0 0 10px white, 0 0 20px white;
      transform: translate(0, 2px);
    }
    user-select: none;
  }

  .up {
    position: relative;
    top: -4px;
  }

  .pressed {
    border-bottom: 8px solid darken(grey, 20);
    text-shadow: 0 0 10px white;
    transform: translate(0, 2px);
  }

  .names {
    font-size: 18px;
    font-family: "Lato", sans-serif;
    text-align: center;
    color: white;
    text-shadow: 0 0 10px white, 0 0 10px white, 0 0 10px white, 0 0 10px white;
  }

  .b {
    color: blue;
    text-shadow: 0 0 10px blue, 0 0 10px blue, 0 0 10px blue, 0 0 10px blue;
    font-size: 100px;
    font-family: serif;
  }

  .a {
    color: yellow;
    text-shadow: 0 0 10px yellow, 0 0 10px yellow, 0 0 10px yellow,
      0 0 10px yellow;
    font-size: 100px;
    font-family: serif;
  }
  .prevent-select {
    -webkit-user-select: none; /* Safari */
    -ms-user-select: none; /* IE 10 and IE 11 */
    user-select: none; /* Standard syntax */
  }
  .noselect {
    -webkit-touch-callout: none; /* iOS Safari */
    -webkit-user-select: none; /* Safari */
    -khtml-user-select: none; /* Konqueror HTML */
    -moz-user-select: none; /* Old versions of Firefox */
    -ms-user-select: none; /* Internet Explorer/Edge */
    user-select: none; /* Non-prefixed version, currently
                                  supported by Chrome, Edge, Opera and Firefox */
  }
</style>
